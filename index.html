<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div>
        <div>
            <div id="map" style="height: 400px; width: 100%;"></div>
        </div>
    </div>


    <script>
        let map;
        let currentPosition;

        function initMap() {
            map=new google.maps.Map(document.getElementById('map'),{
                center: {lat: 23.553118,lng:121.0211024},
                zoom:9,
            });
            navigator.geolocation.getCurrentPosition(function(position){
                currentPosition={
                    lat: position.coords.latitude,
                    lng: position.coords.longitude,
                };
                map.setCenter(currentPosition);
                map.setZoom(16);
            });
            fetch('ubikedata.json')
                .then(response => response.json())
                .then(data => {
                    // console.log(data); 
                    data.retVal.forEach(station => {
                    let marker = new google.maps.Marker({
                        position: {
                            lat: parseFloat(station.lat),
                            lng: parseFloat(station.lng)
                        },
                        map: map,
                        title: station.sna,
                        icon: {
                            url: 'bike (2).png',
                            scaledSize: new google.maps.Size(30, 30) // 設置圖標的大小
                        }
                    });
                    marker.addListener('click', function() {
                        // 創建信息窗口
                        let infowindow = new google.maps.InfoWindow({
                            content:
                            '<div><b>租賃站點查詢:</b> ' + station.sna + '</div>' +
                            '<div><b>站點位置:</b> ' + station.ar + '</div>' +
                            '<div><b>可借車輛:</b> ' + station.sbi + '</div>' +
                            '<div><b>可停空位:</b> ' + station.tot + '</div>'
                        });
                        // 在標記上打開信息窗口
                        infowindow.open(map, marker);
                    });
                });
            })
            .catch(error => console.error('Error loading JSON:', error));
        }
        
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBRVsY6i5vPwpOptbd7H3-kz0SdH_YftyQ&callback=initMap"></script>

</body>
</html>